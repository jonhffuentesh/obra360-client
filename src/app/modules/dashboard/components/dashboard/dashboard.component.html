<div class="p-6 bg-gray-50 dark:bg-gray-900 min-h-screen">
    <!-- Header del Dashboard -->
    <div class="flex justify-between items-center mb-6">
        <button pButton icon="pi pi-refresh" label="Actualizar" class="p-button-outlined" (click)="recargarDashboard()" [loading]="loading" title="Actualizar dashboard"></button>
    </div>

    <!-- Métricas principales -->
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8">
        <!-- Total de ventas del día -->
        <p-card styleClass="h-full">
            <ng-template pTemplate="header">
                <div class="flex items-center justify-between p-4">
                    <div class="p-3 bg-green-100 dark:bg-green-900 rounded-full">
                        <i class="pi pi-dollar text-green-600 dark:text-green-400 text-xl"></i>
                    </div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Hoy</span>
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <div class="text-center">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                        {{ formatearMoneda(ventasHoy.totalVentas) }}
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400">Total de ventas</p>
                </div>
            </ng-template>
        </p-card>

        <!-- Cantidad de ventas del día -->
        <p-card styleClass="h-full">
            <ng-template pTemplate="header">
                <div class="flex items-center justify-between p-4">
                    <div class="p-3 bg-blue-100 dark:bg-blue-900 rounded-full">
                        <i class="pi pi-shopping-cart text-blue-600 dark:text-blue-400 text-xl"></i>
                    </div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Hoy</span>
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <div class="text-center">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                        {{ ventasHoy.cantidadVentas }}
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400">Ventas realizadas</p>
                </div>
            </ng-template>
        </p-card>

        <!-- Promedio de venta -->
        <p-card styleClass="h-full">
            <ng-template pTemplate="header">
                <div class="flex items-center justify-between p-4">
                    <div class="p-3 bg-purple-100 dark:bg-purple-900 rounded-full">
                        <i class="pi pi-chart-line text-purple-600 dark:text-purple-400 text-xl"></i>
                    </div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Hoy</span>
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <div class="text-center">
                    <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
                        {{ formatearMoneda(ventasHoy.promedioVenta) }}
                    </h3>
                    <p class="text-gray-600 dark:text-gray-400">Promedio por venta</p>
                </div>
            </ng-template>
        </p-card>

        <!-- Producto más vendido -->
        <p-card styleClass="h-full" *ngIf="productoMasVendido">
            <ng-template pTemplate="header">
                <div class="flex items-center justify-between p-4">
                    <div class="p-3 bg-orange-100 dark:bg-orange-900 rounded-full">
                        <i class="pi pi-star text-orange-600 dark:text-orange-400 text-xl"></i>
                    </div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Top</span>
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <div class="text-center">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2 truncate">
                        {{ productoMasVendido.nombre }}
                    </h3>
                    <div class="space-y-1">
                        <p class="text-sm text-gray-600 dark:text-gray-400">
                            <span class="font-semibold">{{ productoMasVendido.estadisticas.cantidadVendida }}</span> unidades vendidas
                        </p>
                        <p class="text-xs text-gray-500">{{ productoMasVendido.estadisticas.vecesVendido }} veces vendido</p>
                    </div>
                </div>
            </ng-template>
        </p-card>

        <!-- Día con mayor venta -->
        <p-card styleClass="h-full">
            <ng-template pTemplate="header">
                <div class="flex items-center justify-between p-4">
                    <div class="p-3 bg-green-100 dark:bg-green-900 rounded-full">
                        <i class="pi pi-calendar text-green-600 dark:text-green-400 text-xl"></i>
                    </div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Mejor día</span>
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <div class="text-center" *ngIf="diaMayorVenta">
                    <div class="text-lg font-semibold text-gray-900 dark:text-white mb-2">
                        {{ diaMayorVenta.fecha | date: 'EEEE, d MMMM yyyy' : '' : 'es' }}
                    </div>
                    <div class="space-y-2">
                        <div class="text-2xl font-bold text-green-600 dark:text-green-400">
                            {{ formatearMoneda(diaMayorVenta.totalVentas) }}
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ diaMayorVenta.cantidadVentas }} ventas</p>
                        <p class="text-xs text-gray-500">Promedio: {{ formatearMoneda(diaMayorVenta.promedioVenta) }}</p>
                    </div>
                </div>
                <div class="text-center p-4 text-gray-500" *ngIf="!diaMayorVenta">Sin datos disponibles</div>
            </ng-template>
        </p-card>

        <!-- Hora con mayor venta -->
        <p-card styleClass="h-full">
            <ng-template pTemplate="header">
                <div class="flex items-center justify-between p-4">
                    <div class="p-3 bg-blue-100 dark:bg-blue-900 rounded-full">
                        <i class="pi pi-clock text-blue-600 dark:text-blue-400 text-xl"></i>
                    </div>
                    <span class="text-sm text-gray-500 dark:text-gray-400">Mejor hora</span>
                </div>
            </ng-template>
            <ng-template pTemplate="content">
                <div class="text-center" *ngIf="horaMayorVenta">
                    <div class="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-2">
                        {{ horaMayorVenta.cantidad }}
                    </div>
                    <p class="text-gray-600 dark:text-gray-400">{{ horaMayorVenta.hora }} - {{ horaMayorVenta.cantidad }} ventas</p>
                </div>
                <div class="text-center p-4 text-gray-500" *ngIf="!horaMayorVenta">Sin datos disponibles</div>
            </ng-template>
        </p-card>
    </div>

    <!-- Tabla de facturas del día -->
    <p-card header="Facturas del día" styleClass="mb-8">
        <ng-template pTemplate="content">
            <p-table
                [value]="facturasHoy"
                [loading]="loading"
                [paginator]="true"
                [rows]="10"
                [showCurrentPageReport]="true"
                currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} facturas"
                [rowsPerPageOptions]="[5, 10, 25]"
                styleClass="p-datatable-sm"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Serial</th>
                        <th>Cliente</th>
                        <th>Estado</th>
                        <th>Tipo</th>
                        <th>Total</th>
                        <th>Fecha</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-factura>
                    <tr>
                        <td class="font-mono text-sm">{{ factura.serial }}</td>
                        <td>{{ factura.cliente?.nombre }} {{ factura.cliente?.apellido }}</td>
                        <td>
                            <p-tag [value]="factura.estado" [severity]="factura.estado === 'Pagada' ? 'success' : factura.estado === 'Pendiente' ? 'warning' : 'danger'"> </p-tag>
                        </td>
                        <td>
                            <p-tag [value]="factura.tipoOperacion" [severity]="factura.tipoOperacion === 'Contado' ? 'success' : 'warning'"> </p-tag>
                        </td>
                        <td class="font-semibold">{{ formatearMoneda(factura.total) }}</td>
                        <td class="text-sm">{{ factura.fecha | date: 'short' }}</td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="6" class="text-center py-8 text-gray-500">No hay facturas para mostrar hoy</td>
                    </tr>
                </ng-template>
            </p-table>
        </ng-template>
    </p-card>

    <!-- Productos con stock bajo -->
    <p-card header="Productos con stock bajo" styleClass="mb-8">
        <ng-template pTemplate="content">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" *ngIf="productosStockBajo.length > 0">
                <div *ngFor="let producto of productosStockBajo" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                    <div class="text-center">
                        <h4 class="font-semibold text-gray-900 dark:text-white mb-2">
                            {{ producto.nombre }}
                        </h4>
                        <div class="text-lg font-bold text-red-600">Stock: {{ producto.stockActual }}</div>
                        <p class="text-sm text-gray-500">Mínimo: {{ producto.stockMin }}</p>
                    </div>
                </div>
            </div>

            <div class="text-center py-8 text-gray-500" *ngIf="productosStockBajo.length === 0">No hay productos con stock bajo</div>
        </ng-template>
    </p-card>
</div>
